/* base.scss */
@use "sass:color";
@use 'settings/fonts';
@use 'settings/colors-dark';
@use 'settings/style-settings.scss';
@use 'settings/decorations.scss';

/* --- Links & Tags Variables --- */
:root {
  /* Links */
  --link-internal-color: #0000ee;
  --link-internal-hover-color: #0000ee;
  --link-external-color: #0000ee;
  --link-external-hover-color: #0000ee;

  /* Tags */
  --tag-color: #5460ab; /* light mode default */
  --tag-hover-color: #dc388f; /* light mode default */
  --tag-background: none;
  --tag-background-hover: none;
  --tag-padding-x: 0.1em;
  --tag-padding-y: 0.2em;
  --tag-border-width: 0px;
  --tag-radius: 0px;

  /* Pandoc/WriterCitations defaults (light) */
  --pwc-link-color: #0000ee;
  --pwc-citation-color: #666666;
  --pwc-citation-color-missing: #cc0000;
  --pwc-citation-underline-color: #cc0000;
  --pwc-citation-underline-color-missing: #cc0000;
  --pwc-citation-formatting-color: #cc0000;
  --pwc-citation-extra-color: #cc0000;
  --cursor-link: pointer;
}

.theme-dark {
  /* Links */
  --link-internal-color: #41BF9B;
  --link-internal-hover-color: #41BF9B;
  --link-external-color: #AABF0B;
  --link-external-hover-color: #AABF0B;

  /* Tags */
  --tag-color: #8A9697; /* dark mode default */
  --tag-hover-color: #41BF9B; /* dark mode default */

  /* Pandoc/WriterCitations defaults (dark) */
  --pwc-link-color: #F9CC6C;
  --pwc-citation-color: #948A8B;
  --pwc-citation-color-missing: #F38D70;
  --pwc-citation-underline-color: #F38D70;
  --pwc-citation-underline-color-missing: #F38D70;
  --pwc-citation-formatting-color: #F38D70;
  --pwc-citation-extra-color: #F38D70;
}

/* Apply background and base text color */
body.theme-dark {
  background-color: colors-dark.$background;
  color: colors-dark.$text;

  /* === Heading Variables for Style Settings plugin === */
  --heading-1-color: var(--heading-1-color, #D96C0D);
  --heading-1-line-height: var(--heading-1-line-height, 1.2);
  --heading-1-spacing-after: var(--heading-1-spacing-after, 0.75em);

  --heading-2-color: var(--heading-2-color, #F25C05);
  --heading-2-line-height: var(--heading-2-line-height, 1.2);
  --heading-2-spacing-after: var(--heading-2-spacing-after, 0.75em);

  --heading-3-color: var(--heading-3-color, #F29F05);
  --heading-3-line-height: var(--heading-3-line-height, 1.2);
  --heading-3-spacing-after: var(--heading-3-spacing-after, 0.75em);

  --heading-4-color: var(--heading-4-color, #BF6B04);
  --heading-4-line-height: var(--heading-4-line-height, 1.2);
  --heading-4-spacing-after: var(--heading-4-spacing-after, 0.75em);

  --heading-5-color: var(--heading-5-color, #B149BF);
  --heading-5-line-height: var(--heading-5-line-height, 1.2);
  --heading-5-spacing-after: var(--heading-5-spacing-after, 0.75em);

  --heading-6-color: var(--heading-6-color, #F2E63D);
  --heading-6-line-height: var(--heading-6-line-height, 1.2);
  --heading-6-spacing-after: var(--heading-6-spacing-after, 0.75em);

}

/* === Body Text Leading & Line Spacing === */
.markdown-preview-view,
.markdown-reading-view,
.markdown-source-view,
.cm-content,
.cm-s-obsidian .cm-content {
  color: var(--body-text-color, colors-dark.$text);
  line-height: var(--body-line-height, 1.7); // Adjust for leading
  letter-spacing: var(--body-letter-spacing, 0.015em); // Optional: subtle tracking
  font-size: var(--body-font-size, 22px);
}

/* === Emphasis === */
.markdown-preview-view strong,
.markdown-source-view strong,
.markdown-reading-view strong,
.cm-content strong,
.cm-s-obsidian strong {
  font-weight: bold;
  color: var(--emphasis-bold-color, colors-dark.$bold-color);
}

.markdown-preview-view em,
.markdown-source-view em,
.markdown-reading-view em,
.cm-content em,
.cm-s-obsidian em {
  font-style: italic;
  color: var(--emphasis-italic-color, colors-dark.$italic-color);
}

.markdown-preview-view strong em,
.markdown-source-view strong em,
.markdown-reading-view strong em,
.markdown-preview-view em strong,
.markdown-source-view em strong,
.markdown-reading-view em strong,
.cm-content strong.em,
.cm-content em.strong,
.cm-s-obsidian strong.em,
.cm-s-obsidian em.strong {
  font-weight: bold;
  font-style: italic;
  color: var(--emphasis-bolditalic-color, colors-dark.$bolditalic-color);
}

.markdown-preview-view del,
.markdown-source-view del,
.markdown-reading-view del,
.cm-content del,
.cm-s-obsidian del {
  text-decoration: line-through;
  color: var(--emphasis-strikethrough-color, colors-dark.$strikethrough-color);
}

/* === Blockquotes === */
.markdown-preview-view blockquote,
.markdown-source-view blockquote,
.markdown-reading-view blockquote,
.cm-content blockquote,
.cm-s-obsidian .HyperMD-quote {
  color: var(--blockquote-text-color, colors-dark.$blockquote-color);
  background-color: var(--blockquote-background-color, colors-dark.$blockquote-background-color);
  border-inline-start: 4px solid var(--blockquote-border-color, colors-dark.$blockquote-border);
  padding-left: 1em;
  margin: 1em 0;
}

.cm-s-obsidian span.cm-quote {
  color: var(--blockquote-text-color, colors-dark.$blockquote-color);
}

/* === Code === */
.markdown-preview-view code,
.markdown-source-view code,
.markdown-reading-view code,
.cm-content code,
.cm-s-obsidian code,
.markdown-preview-view .inline-code,
.markdown-source-view .inline-code,
.markdown-reading-view .inline-code,
.cm-content .inline-code,
.cm-s-obsidian .inline-code {
  background-color: var(--inline-code-background-color, colors-dark.$inline-code-bg);
  color: var(--inline-code-text-color, colors-dark.$inline-code-text);
  padding: 2px 4px;
  border-radius: 4px;
  font-family: inherit;
}

.markdown-preview-view pre,
.markdown-source-view pre,
.markdown-reading-view pre,
.cm-content pre,
.cm-s-obsidian pre,
.HyperMD-codeblock,
.HyperMD-codeblock-bg,
.HyperMD-codeblock-begin,
.HyperMD-codeblock-end,
.markdown-preview-view .markdown-rendered pre,
.cm-s-obsidian div.HyperMD-codeblock-bg {
  background-color: var(--code-background-color, colors-dark.$code-bg) !important;
  color: var(--code-text-color, colors-dark.$code-text) !important;
  padding: 2em;
  line-height: 1.8em; // Ensure it matches or exceeds flair size
  border-radius: 0px;
  overflow-x: auto;
}

/* === Code Block Flair Adjustment === */
.cm-code-block-flair {
  height: 1.5em; // adjust as needed
  line-height: 1.5em; // match height to prevent overflow
  padding: 0;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 1.5em;
  overflow: hidden;
}

// === Code Block Flair SVG Icon Customization ===
.cm-code-block-flair svg {
  stroke: var(--code-icon-color, colors-dark.$icon-color);
  width: 1em;
  height: 1em;
  transition: stroke 0.2s ease;
}

.cm-code-block-flair:hover svg {
  filter: brightness(1.2);
}




/* === Checkboxes === */
.markdown-preview-view input[type="checkbox"],
.markdown-source-view input[type="checkbox"],
.markdown-reading-view input[type="checkbox"],
.cm-content input[type="checkbox"],
.cm-s-obsidian input[type="checkbox"] {
  accent-color: var(--checkbox-color, colors-dark.$checkbox-unchecked);
}

.markdown-preview-view input[type="checkbox"]:checked,
.markdown-source-view input[type="checkbox"]:checked,
.markdown-reading-view input[type="checkbox"]:checked,
.cm-content input[type="checkbox"]:checked,
.cm-s-obsidian input[type="checkbox"]:checked {
  accent-color: var(--checkbox-color, colors-dark.$checkbox-checked);
}

/* === Links === */
.markdown-preview-view a.internal-link,
.markdown-source-view a.internal-link,
.markdown-reading-view a.internal-link,
.cm-content a.internal-link,
.cm-s-obsidian a.internal-link,
.cm-hmd-internal-link a,
.cm-link a.internal-link,
.markdown-rendered a.internal-link {
  color: var(--link-internal-color, colors-dark.$link-internal-color) !important;
  text-decoration: none !important;
}

// External link styling: high specificity and coverage
.markdown-preview-view a.external-link,
.markdown-source-view a.external-link,
.markdown-reading-view a.external-link,
.cm-content a.external-link,
.cm-s-obsidian a.external-link,
.cm-url.external-link,
.cm-link a:not(.internal-link),
.markdown-rendered a.external-link,
.markdown-rendered a:not(.internal-link) {
  color: var(--link-external-color, colors-dark.$link-external-color) !important;
  text-decoration: none !important;
}

/* Hover styles */
.markdown-preview-view a.internal-link:hover,
.markdown-source-view a.internal-link:hover,
.markdown-reading-view a.internal-link:hover,
.cm-content a.internal-link:hover,
.cm-s-obsidian a.internal-link:hover,
.cm-hmd-internal-link a:hover,
.cm-link a.internal-link:hover,
.markdown-rendered a.internal-link:hover {
  color: var(--link-internal-hover-color, colors-dark.$link-internal-color) !important;
  text-decoration: underline;
}

/* --- Tags --- */
body .tag,
body .cm-s-obsidian span.cm-hashtag {
  color: var(--tag-color);
  background: var(--tag-background);
  border: var(--tag-border-width) solid var(--tag-color);
  padding: var(--tag-padding-y) var(--tag-padding-x);
  border-radius: var(--tag-radius) !important;
  vertical-align: baseline;
}

/* Neutralize hash sub-spans/pseudo used by Obsidian/CodeMirror */
body .cm-s-obsidian span.cm-formatting-hashtag,
body .cm-s-obsidian span.cm-hashtag-begin,
body .cm-s-obsidian span.cm-hashtag-end {
  background: var(--tag-background) !important;
  border: none !important;
  border-radius: var(--tag-radius, 0px) !important;
}

/* In reading view some themes add pill via ::before on .tag */
body .markdown-rendered .tag::before,
body .markdown-preview-view .tag::before {
  background: var(--tag-background) !important;
  border: none !important;
  border-radius: var(--tag-radius, 0px) !important;
}

/* Ensure zero-radius default applies without user interaction */
body .markdown-rendered .tag,
body .markdown-preview-view .tag,
body .markdown-source-view .tag,
body .cm-s-obsidian span.cm-hashtag,
body .multi-select-pill {
  border-radius: var(--tag-radius, 0px) !important;
}

/* --- Pandoc/WriterCitations overrides --- */
/* Remove underline decorations on resolved citations */
.pwc-tooltips :not(.cm-link-alias) > :is(.pandoc-citation, .at).is-resolved {
  text-decoration: none !important;
}

/* Base link look for citations controlled by style settings */
.pwc-tooltips :not(a, .cm-hmd-internal-link, .cm-link-alias) > :is(.pandoc-citation, .at).is-link {
  color: var(--pwc-link-color);
  cursor: var(--cursor-link);
}

/* Resolved citation color */
.pwc-tooltips :not(a, .cm-hmd-internal-link, .cm-link-alias) > :is(.pandoc-citation, .at).is-resolved {
  color: var(--pwc-citation-color);
}

/* Treat CM editor bare links as external link color */
.cm-s-obsidian span.cm-link {
  color: var(--link-external-color);
  word-break: break-word;
}
body .tag:hover,
body .cm-s-obsidian span.cm-hashtag:hover {
  color: var(--tag-hover-color);
  background: var(--tag-background-hover);
  border-color: var(--tag-hover-color);
}

/* Tags within Properties/Frontmatter editor */
body .multi-select-pill {
  color: var(--tag-color);
  background: var(--tag-background);
  border: var(--tag-border-width) solid var(--tag-color);
  padding: var(--tag-padding-y) var(--tag-padding-x);
  border-radius: var(--tag-radius) !important;

  .multi-select-pill-remove-button {
    display: none;
  }
}

body .multi-select-pill:hover {
  color: var(--tag-hover-color);
  background: var(--tag-background-hover);
  border-color: var(--tag-hover-color);
}

.tag-decoration-hover .markdown-preview-view .tag:hover,
.tag-decoration-hover .markdown-source-view .tag:hover,
.tag-decoration-hover .markdown-reading-view .tag:hover,
.tag-decoration-hover .markdown-rendered .tag:hover,
.tag-decoration-hover .cm-s-obsidian span.cm-hashtag:hover {
  text-decoration: underline;
}

.markdown-preview-view a.external-link:hover,
.markdown-source-view a.external-link:hover,
.markdown-reading-view a.external-link:hover,
.cm-content a.external-link:hover,
.cm-s-obsidian a.external-link:hover,
.cm-url.external-link:hover,
.cm-link a:not(.internal-link):hover,
.markdown-rendered a.external-link:hover,
.markdown-rendered a:not(.internal-link):hover {
  color: var(--link-external-hover-color, colors-dark.$link-external-color) !important;
  text-decoration: underline;
}

/* === Headings === */
.cm-header-1 { color: colors-dark.$h1-color; }
.cm-header-2 { color: colors-dark.$h2-color; }
.cm-header-3 { color: colors-dark.$h3-color; }
.cm-header-4 { color: colors-dark.$h4-color; }
.cm-header-5 { color: colors-dark.$h5-color; }
.cm-header-6 { color: colors-dark.$h6-color; }

.markdown-preview-view h1,
.markdown-source-view h1,
.markdown-reading-view h1,
.cm-content h1,
.cm-s-obsidian .cm-header-1 {
  color: var(--heading-1-color, colors-dark.$h1-color);
  line-height: var(--heading-1-line-height, 1.2);
  margin-bottom: var(--heading-1-spacing-after, 0.75em);
}

.markdown-preview-view h2,
.markdown-source-view h2,
.markdown-reading-view h2,
.cm-content h2,
.cm-s-obsidian .cm-header-2 {
  color: var(--heading-2-color, colors-dark.$h2-color);
  line-height: var(--heading-2-line-height, 1.2);
  margin-bottom: var(--heading-2-spacing-after, 0.75em);
}

.markdown-preview-view h3,
.markdown-source-view h3,
.markdown-reading-view h3,
.cm-content h3,
.cm-s-obsidian .cm-header-3 {
  color: var(--heading-3-color, colors-dark.$h3-color);
  line-height: var(--heading-3-line-height, 1.2);
  margin-bottom: var(--heading-3-spacing-after, 0.75em);
}

.markdown-preview-view h4,
.markdown-source-view h4,
.markdown-reading-view h4,
.cm-content h4,
.cm-s-obsidian .cm-header-4 {
  color: var(--heading-4-color, colors-dark.$h4-color);
  line-height: var(--heading-4-line-height, 1.2);
  margin-bottom: var(--heading-4-spacing-after, 0.75em);
}

.markdown-preview-view h5,
.markdown-source-view h5,
.markdown-reading-view h5,
.cm-content h5,
.cm-s-obsidian .cm-header-5 {
  color: var(--heading-5-color, colors-dark.$h5-color);
  line-height: var(--heading-5-line-height, 1.2);
  margin-bottom: var(--heading-5-spacing-after, 0.75em);
}

.markdown-preview-view h6,
.markdown-source-view h6,
.markdown-reading-view h6,
.cm-content h6,
.cm-s-obsidian .cm-header-6 {
  color: var(--heading-6-color, colors-dark.$h6-color);
  line-height: var(--heading-6-line-height, 1.2);
  margin-bottom: var(--heading-6-spacing-after, 0.75em);
}

/* === Emphasis in Editor View (CodeMirror) === */
.cm-strong {
  color: var(--emphasis-bold-color, colors-dark.$bold-color);
}

.cm-em {
  color: var(--emphasis-italic-color, colors-dark.$italic-color);
}

.cm-strong.cm-em,
.cm-em.cm-strong {
  color: var(--emphasis-bolditalic-color, colors-dark.$bolditalic-color);
}

.cm-strikethrough {
  color: var(--emphasis-strikethrough-color, colors-dark.$strikethrough-color);
}


.cm-quote {
  color: var(--blockquote-text-color, colors-dark.$blockquote-color);
}

.HyperMD-quote:not(.HyperMD-quote-1) {
  border-left: 4px solid var(--blockquote-border-color, colors-dark.$blockquote-border);
  background-color: var(--blockquote-background-color, colors-dark.$blockquote-background-color);
  padding-left: 1em;
  margin: 1em 0;
}


/* (Handled above for marker color) */

/* (Handled above for marker and formatting list color) */





